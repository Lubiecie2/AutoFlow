@* filepath: c:\Users\kgruc\source\repos\autoflow\autoflow\Views\Account\Login.cshtml *@
@{
    ViewData["Title"] = "Logowanie";
}

<div class="login-container">
    <div class="left-section">
        <div class="left-title">
            <h1>Zarządzaj swoim warsztatem z nami</h1>
            <p>
                Zdobądź pełną kontrolę nad swoim biznesem <br />
                dzięki naszemu systemowi AutoFlow, który jest oparty <br />
                na najnowszych technologiach i doświadczeniu
            </p>
        </div>
    </div>
    <div class="right-section">
        <div class="login-form">
            <div class="back-button">
                <button class="square-btn" onclick="window.location.href='/'">
                    ←
                </button>
                <span class="back-text">Powrót</span>
            </div>
            <div class="welcome-text">
                <h2>Witaj!</h2>
                <p>Zaloguj się na swoje konto.</p>
            </div>
            <div class="login-input">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Nazwa użytkownika:</label>
                        <input type="text" id="username" name="username" required />
                    </div>
                    <div class="form-group">
                        <label for="password">Hasło:</label>
                        <input type="password" id="password" name="password" required />
                    </div>
                    <p id="errorMessage" class="error-message" style="display: none;"></p>
                    <div class="submit-button-container">
                        <button class="submit-button" type="submit">
                            Zaloguj się
                        </button>
                    </div>
                </form>
            </div>
            <hr class="break-line" />
            <div class="under-text">
                <a>Nie masz konta?</a>
                <a href="/Account/Register" class="button-classic">
                    Zarejestruj się
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            
            try {
                const response = await fetch('/Account/Login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    window.location.href = '/';
                } else {
                    errorMessage.textContent = data.message;
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = 'Wystąpił błąd podczas logowania';
                errorMessage.style.display = 'block';
            }
        });
    </script>
}
