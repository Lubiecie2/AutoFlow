@* filepath: c:\Users\kgruc\source\repos\autoflow\autoflow\Views\Account\Register.cshtml *@
@{
    ViewData["Title"] = "Rejestracja";
}

<div class="login-container">
    <div class="left-section">
        <div class="left-title">
            <h1>Dołącz do AutoFlow</h1>
            <p>
                Utwórz konto i zacznij zarządzać <br />
                swoim warsztatem jeszcze dziś <br />
                w prosty i nowoczesny sposób
            </p>
        </div>
    </div>
    <div class="right-section">
        <div class="login-form">
            <div class="back-button">
                <button class="square-btn" onclick="window.location.href='/'">
                    ←
                </button>
                <span class="back-text">Powrót</span>
            </div>
            <div class="welcome-text">
                <h2>Rejestracja</h2>
                <p>Utwórz nowe konto.</p>
            </div>
            <div class="login-input">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="username">Nazwa użytkownika:</label>
                        <input type="text" id="username" name="username" required minlength="3" />
                    </div>
                    <div class="form-group">
                        <label for="password">Hasło:</label>
                        <input type="password" id="password" name="password" required minlength="6" />
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Potwierdź hasło:</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required />
                    </div>
                    <p id="errorMessage" class="error-message" style="display: none;"></p>
                    <div class="submit-button-container">
                        <button class="submit-button" type="submit">
                            Zarejestruj się
                        </button>
                    </div>
                </form>
            </div>
            <hr class="break-line" />
            <div class="under-text">
                <a>Masz już konto?</a>
                <a href="/Account/Login" class="button-classic">
                    Zaloguj się
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorMessage = document.getElementById('errorMessage');
            
            if (password !== confirmPassword) {
                errorMessage.textContent = 'Hasła nie są zgodne';
                errorMessage.style.display = 'block';
                return;
            }
            
            try {
                const response = await fetch('/Account/Register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password, confirmPassword })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    window.location.href = '/';
                } else {
                    errorMessage.textContent = data.message;
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = 'Wystąpił błąd podczas rejestracji';
                errorMessage.style.display = 'block';
            }
        });
    </script>
}
